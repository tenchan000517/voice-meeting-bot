# ğŸ”„ Discord Bot æ°¸ç¶šç¨¼åƒãƒ•ãƒ­ãƒ¼å®Œå…¨ã‚¬ã‚¤ãƒ‰

**å¯¾è±¡**: é–‹ç™ºãƒãƒ¼ãƒ ãƒ»é‹ç”¨ãƒãƒ¼ãƒ ãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å…¨èˆ¬  
**æ›´æ–°æ—¥**: 2025å¹´6æœˆ24æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¢ æœ¬ç•ªé‹ç”¨ä¸­

## ğŸ¯ æ°¸ç¶šç¨¼åƒã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚    â”‚                  â”‚    â”‚                     â”‚
â”‚   é–‹ç™ºè€…        â”‚â”€â”€â”€â–¶â”‚   GitHub         â”‚â”€â”€â”€â–¶â”‚   EC2 (Auto-Deploy) â”‚
â”‚   (ãƒ­ãƒ¼ã‚«ãƒ«)     â”‚    â”‚   Repository     â”‚    â”‚   Discord Bot       â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚                     â”‚
                                                â”‚  Python API Server  â”‚
                                                â”‚  (ãƒ­ãƒ¼ã‚«ãƒ«ç¨¼åƒ)      â”‚
                                                â”‚                     â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼

### âš¡ ãƒ•ãƒ«è‡ªå‹•ãƒ•ãƒ­ãƒ¼ (æ¨å¥¨)
```bash
# 1. é–‹ç™ºè€…å´ (ãƒ­ãƒ¼ã‚«ãƒ«)
git add .
git commit -m "æ–°æ©Ÿèƒ½è¿½åŠ "
git push origin main

# 2. EC2å´ (å®Œå…¨è‡ªå‹•)
# â†’ 5åˆ†ä»¥å†…ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹
#   - git fetch origin main
#   - å¤‰æ›´æ¤œçŸ¥
#   - git pull origin main  
#   - npm install (package.jsonå¤‰æ›´æ™‚ã®ã¿)
#   - systemctl restart voice-meeting-discord-bot.service
#   - å¥å…¨æ€§ç¢ºèª

# 3. çµæœç¢ºèª (æ‰‹å‹•)
ssh find-to-do
monitor-bot  # æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¨¼åƒç¢ºèª
```

### ğŸ“‹ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¾‹
```
14:00:00  é–‹ç™ºè€…: git push origin main (æ–°æ©Ÿèƒ½)
14:02:30  EC2: å¤‰æ›´ãªã— (ã¾ã æ¤œå‡ºå‰)  
14:05:00  EC2: å¤‰æ›´æ¤œçŸ¥ï¼è‡ªå‹•æ›´æ–°é–‹å§‹
14:05:10  EC2: git pullå®Œäº†
14:05:15  EC2: service restartå®Œäº†  
14:05:20  EC2: æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¨¼åƒé–‹å§‹
14:05:30  EC2: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ - æ­£å¸¸ç¢ºèª
```

## ğŸ› ï¸ æ‰‹å‹•é‹ç”¨ã‚³ãƒãƒ³ãƒ‰

### ğŸ“Š ç›£è¦–ãƒ»ç¢ºèªã‚³ãƒãƒ³ãƒ‰
```bash
# ç·åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
monitor-bot

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
bot-status

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°è¡¨ç¤º
bot-logs

# è‡ªå‹•æ›´æ–°å±¥æ­´ç¢ºèª
tail -f /var/log/voice-meeting-bot-update.log

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å±¥æ­´ç¢ºèª
tail -f /var/log/voice-meeting-bot-health.log
```

### ğŸ”§ ç·Šæ€¥æ™‚å¯¾å¿œã‚³ãƒãƒ³ãƒ‰
```bash
# æ‰‹å‹•ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
bot-restart

# æ‰‹å‹•æ›´æ–°å®Ÿè¡Œ
bot-update

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
bot-health

# cronè¨­å®šç¢ºèª
crontab -l

# ãƒ—ãƒ­ã‚»ã‚¹è©³ç´°ç¢ºèª
ps aux | grep node
ss -tln | grep 3003
```

## ğŸ¯ é–‹ç™ºè€…å‘ã‘ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### âœ… æ¨å¥¨é–‹ç™ºãƒ•ãƒ­ãƒ¼
```bash
# 1. æ©Ÿèƒ½é–‹ç™º
git checkout -b feature/new-function
# ... é–‹ç™ºä½œæ¥­ ...
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½å®Ÿè£…"

# 2. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
npm test
npm run lint

# 3. ãƒ—ãƒƒã‚·ãƒ¥ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
git checkout main
git merge feature/new-function
git push origin main  # â† ã“ã“ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹

# 4. æœ¬ç•ªå‹•ä½œç¢ºèª (5-10åˆ†å¾Œ)
ssh find-to-do
monitor-bot
```

### âš ï¸ æ³¨æ„äº‹é …
```bash
# å±é™ºãªå¤‰æ›´æ™‚ã¯äº‹å‰ç¢ºèª
# - package.json ã®ä¾å­˜é–¢ä¿‚å¤‰æ›´
# - ç’°å¢ƒå¤‰æ•°ã®å¤‰æ›´
# - systemdè¨­å®šå¤‰æ›´

# ç¢ºèªæ‰‹é †:
ssh find-to-do
cd ~/voice-meeting-bot
git log --oneline -5  # æœ€æ–°ã‚³ãƒŸãƒƒãƒˆç¢ºèª
monitor-bot           # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª
```

## ğŸ›¡ï¸ éšœå®³å¯¾å¿œãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ğŸš¨ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•

#### **å•é¡Œ1**: ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ãªã„
```bash
# è¨ºæ–­
sudo systemctl status voice-meeting-discord-bot.service
sudo journalctl -u voice-meeting-discord-bot.service -n 50

# è§£æ±º
cd /home/ec2-user/voice-meeting-bot/node-bot
node index.js  # æ‰‹å‹•èµ·å‹•ãƒ†ã‚¹ãƒˆ
bot-restart    # ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
```

#### **å•é¡Œ2**: è‡ªå‹•æ›´æ–°ãŒå‹•ä½œã—ãªã„
```bash
# è¨ºæ–­
crontab -l  # cronè¨­å®šç¢ºèª
tail -20 /var/log/voice-meeting-bot-update.log

# è§£æ±º
./deploy/auto-update.sh  # æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
```

#### **å•é¡Œ3**: Webhookå¿œç­”ãªã—
```bash
# è¨ºæ–­
curl -X POST http://localhost:3003/webhook/meeting-completed \
  -H "Content-Type: application/json" \
  -d '{"test":"data"}'

# è§£æ±º
ss -tln | grep 3003  # ãƒãƒ¼ãƒˆç¢ºèª
bot-restart          # ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
```

### ğŸ”„ ç·Šæ€¥å¾©æ—§æ‰‹é †
```bash
# 1. ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
monitor-bot

# 2. å¼·åˆ¶å†èµ·å‹•
sudo systemctl stop voice-meeting-discord-bot.service
sudo systemctl start voice-meeting-discord-bot.service

# 3. è¨­å®šãƒªã‚»ãƒƒãƒˆ (æœ€å¾Œã®æ‰‹æ®µ)
cd ~/voice-meeting-bot
git reset --hard origin/main
./deploy/setup-complete.sh
```

## ğŸ“Š ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ğŸ¯ ç›£è¦–å¯¾è±¡é …ç›®
| é …ç›® | æ­£å¸¸ç¯„å›² | ç¢ºèªæ–¹æ³• |
|------|----------|----------|
| **CPUä½¿ç”¨ç‡** | < 10% | `monitor-bot` |
| **ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡** | < 15% | `monitor-bot` |
| **ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡** | < 80% | `monitor-bot` |
| **ãƒ—ãƒ­ã‚»ã‚¹ç¨¼åƒ** | Running | `bot-status` |
| **Port 3003** | Listening | `monitor-bot` |
| **Webhookå¿œç­”** | 200 OK | `monitor-bot` |

### ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
```bash
# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡è©³ç´°
echo "=== CPUãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ ==="
ps aux | grep "node index.js" | grep -v grep

echo "=== ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ ==="
df -h /
du -sh /tmp/voice-meeting-bot/temp/

echo "=== ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ ==="
ss -tln | grep 3003
```

## ğŸ”„ å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ğŸ“… æ¨å¥¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

#### **æ¯æ—¥** (è‡ªå‹•å®Ÿè¡Œ)
- âœ… è‡ªå‹•æ›´æ–°ãƒã‚§ãƒƒã‚¯ (5åˆ†é–“éš”)
- âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (10åˆ†é–“éš”)  
- âœ… ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

#### **é€±æ¬¡** (æ‰‹å‹•æ¨å¥¨)
```bash
# ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç·åˆç¢ºèª
monitor-bot

# å¤ã„éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—  
monitor-bot clean

# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°ç¢ºèª
sudo dnf check-update
```

#### **æœˆæ¬¡** (æ‰‹å‹•æ¨å¥¨)
```bash
# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
sudo logrotate -f /etc/logrotate.d/voice-meeting-bot

# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ›´æ–° (æ…é‡ã«)
sudo dnf update

# è¨­å®šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp -r ~/voice-meeting-bot/node-bot/.env ~/backup/
```

## ğŸ‰ ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ğŸš€ è¿½åŠ å¯èƒ½ãªæ©Ÿèƒ½
```bash
# Slacké€šçŸ¥é€£æº
# webhook-server.js ã«Slacké€šçŸ¥è¿½åŠ 

# ç›£è¦–ãƒ¡ãƒˆãƒªã‚¯ã‚¹å¼·åŒ–  
# Prometheus/Grafanaé€£æº

# è¤‡æ•°ç’°å¢ƒå¯¾å¿œ
# staging/productionç’°å¢ƒåˆ†é›¢

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è‡ªå‹•åŒ–
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»è¨­å®šè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
```

---

**ğŸ¤– ã“ã®ã‚¬ã‚¤ãƒ‰ã¯Discord Botæ°¸ç¶šç¨¼åƒã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ãªé‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã™**  
**è³ªå•ãƒ»å•é¡ŒãŒã‚ã‚‹å ´åˆã¯é–‹ç™ºãƒãƒ¼ãƒ ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„**

**æœ€çµ‚æ›´æ–°**: 2025å¹´6æœˆ24æ—¥ 19:25 JST  
**ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ³**: ğŸŸ¢ **æ­£å¸¸ç¨¼åƒä¸­**